<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C304 | Management Accounting Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: '#1B2A4A',
                        'navy-light': '#2C3E50',
                        'gray-bg': '#F8F9FA',
                        'gray-border': '#DEE2E6',
                        cipla: '#00539C',
                        nestle: '#1A3C5E',
                        'nestle-gold': '#C8A84B',
                        voltas: '#C0392B',
                        'voltas-orange': '#E67E22',
                        success: '#198754',
                        warning: '#DC3545',
                        neutral: '#EFF3F8'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F9FA; color: #212529; }
        .page-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .nav-item { cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .nav-item:hover { color: #1B2A4A; }
        .nav-item.active { border-bottom-color: currentColor; font-weight: 600; }
        
        .card { background: white; border: 1px solid #DEE2E6; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .tab-btn { padding: 10px 20px; color: #6C757D; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 500; font-size: 14px; }
        .tab-btn:hover { color: #1B2A4A; }
        .tab-btn.active { color: #1B2A4A; border-bottom-color: #1B2A4A; font-weight: 600; }
        
        .kpi-pill { padding: 4px 12px; border-radius: 999px; font-size: 12px; font-weight: 600; }
        .kpi-ok { background-color: #D1E7DD; color: #0F5132; }
        .kpi-warn { background-color: #F8D7DA; color: #842029; }
        
        .insight-box { background-color: #EFF3F8; border-left-width: 4px; padding: 16px; border-radius: 0 8px 8px 0; font-size: 13px; line-height: 1.6; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background-color: #1B2A4A; color: white; text-transform: uppercase; font-size: 11px; padding: 10px; text-align: center; letter-spacing: 0.5px; }
        th:first-child { text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #DEE2E6; text-align: center; }
        td:first-child { text-align: left; font-weight: 500; }
        tr:nth-child(even) { background-color: #F8F9FA; }
        tr:hover { background-color: #EFF3F8; }
        
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        /* Filter Buttons */
        .filter-btn { transition: all 0.2s; border: 1px solid #DEE2E6; color: #6C757D; background: white; }
        .filter-btn:hover { border-color: #1B2A4A; color: #1B2A4A; }
        .filter-btn.active { background-color: #1B2A4A; color: white; border-color: #1B2A4A; }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white border-b border-gray-border z-50 h-16 flex items-center justify-between px-8 shadow-sm">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-navy text-white flex items-center justify-center font-bold rounded">MA</div>
            <span class="font-semibold text-navy tracking-tight">C304 | Management Accounting</span>
        </div>
        <div class="flex gap-8 text-sm text-gray-500">
            <div onclick="showPage('home')" class="nav-item active text-navy border-navy" id="nav-home">HOME</div>
            <div onclick="showPage('cipla')" class="nav-item hover:text-cipla" id="nav-cipla">CIPLA</div>
            <div onclick="showPage('nestle')" class="nav-item hover:text-nestle" id="nav-nestle">NESTL√â</div>
            <div onclick="showPage('voltas')" class="nav-item hover:text-voltas" id="nav-voltas">VOLTAS</div>
            <div onclick="showPage('industry')" class="nav-item hover:text-navy" id="nav-industry">INDUSTRY COMPARISON</div>
        </div>
        <div class="text-xs text-gray-400 font-medium">
            Bloomberg Data | FY2021‚Äì2025
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="pt-24 pb-12 px-8 max-w-7xl mx-auto min-h-screen">

        <!-- PAGE 1: HOME -->
        <section id="page-home" class="page-section active">
            <div class="bg-white p-8 rounded-xl border border-gray-border shadow-sm mb-8 text-center">
                <h1 class="text-3xl font-bold text-navy mb-2">Comparative Cost Structure, Pricing & Control Analysis</h1>
                <p class="text-gray-500 mb-6">Management Accounting ‚Äî C304 | Bloomberg Data | FY2021‚ÄìFY2025</p>
                <div class="flex justify-center gap-4">
                    <span class="px-3 py-1 bg-cipla/10 text-cipla rounded-full text-sm font-semibold">Cipla (Pharma)</span>
                    <span class="px-3 py-1 bg-nestle/10 text-nestle rounded-full text-sm font-semibold">Nestl√© (FMCG)</span>
                    <span class="px-3 py-1 bg-voltas/10 text-voltas rounded-full text-sm font-semibold">Voltas (Capital Goods)</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <!-- Cipla Card -->
                <div class="card p-6 border-t-4 border-t-cipla">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <img src="https://logo.clearbit.com/cipla.com" alt="Cipla Logo" class="h-10 mb-2 object-contain" onerror="this.style.display='none'">
                            <h3 class="text-xl font-bold text-navy">Cipla Ltd</h3>
                            <p class="text-xs text-gray-500">NSE: CIPLA | Pharma</p>
                        </div>
                        <span class="bg-success text-white text-xs px-2 py-1 rounded">‚ñ≤ OUTPERFORM</span>
                    </div>
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-sm"><span class="text-gray-500">FY25 Revenue</span> <span class="font-bold">‚Çπ271,454 Mn</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Gross Margin</span> <span class="font-bold text-success">65.9%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">EBITDA Margin</span> <span class="font-bold text-success">25.7%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Rev CAGR 5Y</span> <span class="font-bold text-success">9.3%</span></div>
                    </div>
                    <button onclick="showPage('cipla')" class="w-full py-2 border border-cipla text-cipla rounded hover:bg-cipla hover:text-white transition text-sm font-medium">View Full Analysis ‚Üí</button>
                </div>

                <!-- Nestle Card -->
                <div class="card p-6 border-t-4 border-t-nestle">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <img src="https://logo.clearbit.com/nestle.com" alt="Nestle Logo" class="h-10 mb-2 object-contain" onerror="this.style.display='none'">
                            <h3 class="text-xl font-bold text-navy">Nestl√© India</h3>
                            <p class="text-xs text-gray-500">NSE: NESTLEIND | FMCG</p>
                        </div>
                        <span class="bg-success text-white text-xs px-2 py-1 rounded">‚ñ≤ OUTPERFORM</span>
                    </div>
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-sm"><span class="text-gray-500">FY25 Revenue</span> <span class="font-bold">‚Çπ200,775 Mn</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Gross Margin</span> <span class="font-bold text-success">56.4%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">EBITDA Margin</span> <span class="font-bold text-success">23.8%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Rev CAGR 5Y</span> <span class="font-bold text-success">13.0%</span></div>
                    </div>
                    <button onclick="showPage('nestle')" class="w-full py-2 border border-nestle text-nestle rounded hover:bg-nestle hover:text-white transition text-sm font-medium">View Full Analysis ‚Üí</button>
                </div>

                <!-- Voltas Card -->
                <div class="card p-6 border-t-4 border-t-voltas">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <img src="https://logo.clearbit.com/voltas.com" alt="Voltas Logo" class="h-10 mb-2 object-contain" onerror="this.style.display='none'">
                            <h3 class="text-xl font-bold text-navy">Voltas Ltd</h3>
                            <p class="text-xs text-gray-500">NSE: VOLTAS | Cap Goods</p>
                        </div>
                        <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded">IN-LINE</span>
                    </div>
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-sm"><span class="text-gray-500">FY25 Revenue</span> <span class="font-bold">‚Çπ154,127 Mn</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Gross Margin</span> <span class="font-bold text-success">22.4%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">EBITDA Margin</span> <span class="font-bold text-success">8.9%</span></div>
                        <div class="flex justify-between text-sm"><span class="text-gray-500">Rev CAGR 5Y</span> <span class="font-bold text-success">19.3%</span></div>
                    </div>
                    <button onclick="showPage('voltas')" class="w-full py-2 border border-voltas text-voltas rounded hover:bg-voltas hover:text-white transition text-sm font-medium">View Full Analysis ‚Üí</button>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div onclick="showPage('cost-structure')" class="card p-4 text-center cursor-pointer hover:bg-gray-50 transition">
                    <div class="text-2xl mb-2">üìä</div>
                    <div class="font-semibold text-navy">Cost Structure</div>
                </div>
                <div onclick="showPage('benchmarking')" class="card p-4 text-center cursor-pointer hover:bg-gray-50 transition">
                    <div class="text-2xl mb-2">‚öñÔ∏è</div>
                    <div class="font-semibold text-navy">Benchmarking</div>
                </div>
                <div onclick="showPage('pricing-analysis')" class="card p-4 text-center cursor-pointer hover:bg-gray-50 transition">
                    <div class="text-2xl mb-2">üìà</div>
                    <div class="font-semibold text-navy">Pricing Analysis</div>
                </div>
                <div onclick="showPage('kpi-dashboard')" class="card p-4 text-center cursor-pointer hover:bg-gray-50 transition">
                    <div class="text-2xl mb-2">üéØ</div>
                    <div class="font-semibold text-navy">KPI Dashboard</div>
                </div>
            </div>

            <p class="text-center text-xs text-gray-400">All data sourced from Bloomberg Terminal. Analysis period: FY2021‚ÄìFY2025. Values in INR Millions.</p>
        </section>

        <!-- TEMPLATE FOR COMPANY PAGES (Content injected via JS) -->
        <div id="company-page-container"></div>

        <!-- PAGE 5: INDUSTRY -->
        <section id="page-industry" class="page-section">
            <div class="mb-6">
                <div class="text-sm text-gray-500 mb-2">Home > Industry Comparison</div>
                <button onclick="showPage('home')" class="text-navy border border-navy px-3 py-1 rounded text-sm hover:bg-navy hover:text-white transition mb-4">‚Üê Back to Home</button>
                <h2 class="text-3xl font-bold text-navy">Industry Comparison</h2>
                <p class="text-gray-500">Cross-Company Benchmarking | Sector Analysis</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="card p-4">
                    <h4 class="font-bold text-cipla mb-4 text-center">Cipla vs Pharma Avg</h4>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="chart-ind-cipla"></canvas>
                    </div>
                </div>
                <div class="card p-4">
                    <h4 class="font-bold text-nestle mb-4 text-center">Nestl√© vs FMCG Avg</h4>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="chart-ind-nestle"></canvas>
                    </div>
                </div>
                <div class="card p-4">
                    <h4 class="font-bold text-voltas mb-4 text-center">Voltas vs Cap Goods Avg</h4>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="chart-ind-voltas"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-8 mb-12">
                <div class="card p-6">
                    <h4 class="font-bold text-navy mb-4">Management Accounting Benchmark Scorecard (FY2025)</h4>
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th class="text-left">Metric</th>
                                    <th class="bg-cipla text-white">Cipla</th>
                                    <th class="bg-gray-100 text-gray-600">Pharma Avg</th>
                                    <th class="bg-gray-100 text-gray-600">Var</th>
                                    <th class="bg-nestle text-white">Nestl√©</th>
                                    <th class="bg-gray-100 text-gray-600">FMCG Avg</th>
                                    <th class="bg-gray-100 text-gray-600">Var</th>
                                    <th class="bg-voltas text-white">Voltas</th>
                                    <th class="bg-gray-100 text-gray-600">Cap.Gds Avg</th>
                                    <th class="bg-gray-100 text-gray-600">Var</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-gray-50 font-bold"><td colspan="10">MARGINS (Higher is Better)</td></tr>
                                <tr>
                                    <td>Gross Margin %</td>
                                    <td class="font-bold">65.9%</td><td>62.0%</td><td class="text-success">‚ñ≤ 3.9pp</td>
                                    <td class="font-bold">56.4%</td><td>55.0%</td><td class="text-success">‚ñ≤ 1.4pp</td>
                                    <td class="font-bold">22.4%</td><td>16.0%</td><td class="text-success">‚ñ≤ 6.4pp</td>
                                </tr>
                                <tr>
                                    <td>EBITDA Margin %</td>
                                    <td class="font-bold">25.7%</td><td>22.5%</td><td class="text-success">‚ñ≤ 3.2pp</td>
                                    <td class="font-bold">23.8%</td><td>22.0%</td><td class="text-success">‚ñ≤ 1.8pp</td>
                                    <td class="font-bold">8.9%</td><td>8.5%</td><td class="text-success">‚ñ≤ 0.4pp</td>
                                </tr>
                                <tr>
                                    <td>PAT Margin %</td>
                                    <td class="font-bold">19.4%</td><td>17.0%</td><td class="text-success">‚ñ≤ 2.4pp</td>
                                    <td class="font-bold">16.0%</td><td>14.5%</td><td class="text-success">‚ñ≤ 1.5pp</td>
                                    <td class="font-bold">5.4%</td><td>4.8%</td><td class="text-success">‚ñ≤ 0.6pp</td>
                                </tr>
                                
                                <tr class="bg-gray-50 font-bold"><td colspan="10">COST EFFICIENCY (Lower is Better)</td></tr>
                                <tr>
                                    <td>COGS / Revenue</td>
                                    <td class="font-bold">34.1%</td><td>38.0%</td><td class="text-success">‚ñ≤ 3.9pp</td>
                                    <td class="font-bold">43.6%</td><td>45.0%</td><td class="text-success">‚ñ≤ 1.4pp</td>
                                    <td class="font-bold">77.6%</td><td>82.0%</td><td class="text-success">‚ñ≤ 4.4pp</td>
                                </tr>
                                <tr>
                                    <td>Employee / Revenue</td>
                                    <td class="font-bold">17.8%</td><td>18.5%</td><td class="text-success">‚ñ≤ 0.7pp</td>
                                    <td class="font-bold">10.1%</td><td>9.5%</td><td class="text-warning">‚ñº 0.6pp</td>
                                    <td class="font-bold">5.8%</td><td>6.5%</td><td class="text-success">‚ñ≤ 0.7pp</td>
                                </tr>
                                
                                <tr class="bg-gray-50 font-bold"><td colspan="10">RETURNS & GROWTH</td></tr>
                                <tr>
                                    <td>ROE %</td>
                                    <td class="font-bold">18.1%</td><td>18.0%</td><td class="text-success">‚ñ≤ 0.1pp</td>
                                    <td class="font-bold">80.0%</td><td>32.0%</td><td class="text-success">‚ñ≤ 48.0pp</td>
                                    <td class="font-bold">12.9%</td><td>16.0%</td><td class="text-warning">‚ñº 3.1pp</td>
                                </tr>
                                <tr>
                                    <td>Rev CAGR (5Y)</td>
                                    <td class="font-bold">9.3%</td><td>8.5%</td><td class="text-success">‚ñ≤ 0.8pp</td>
                                    <td class="font-bold">13.0%</td><td>11.2%</td><td class="text-success">‚ñ≤ 1.8pp</td>
                                    <td class="font-bold">19.3%</td><td>15.8%</td><td class="text-success">‚ñ≤ 3.5pp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="card p-6 mb-12">
                <h4 class="font-bold text-navy mb-4">Overall Industry Positioning Summary</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="border-l-4 border-cipla pl-4">
                        <h5 class="font-bold text-cipla text-lg">Cipla (Pharma)</h5>
                        <div class="text-sm space-y-2 mt-2">
                            <div class="flex justify-between"><span>Overall Rating:</span> <span class="font-bold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</span></div>
                            <div class="flex justify-between"><span>Verdict:</span> <span class="font-bold text-success">OUTPERFORM</span></div>
                            <div class="text-gray-600 mt-2"><strong>Key Strength:</strong> Margin expansion + R&D moat.</div>
                            <div class="text-gray-600"><strong>Key Risk:</strong> DPCO pricing controls.</div>
                        </div>
                    </div>
                    <div class="border-l-4 border-nestle pl-4">
                        <h5 class="font-bold text-nestle text-lg">Nestl√© (FMCG)</h5>
                        <div class="text-sm space-y-2 mt-2">
                            <div class="flex justify-between"><span>Overall Rating:</span> <span class="font-bold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</span></div>
                            <div class="flex justify-between"><span>Verdict:</span> <span class="font-bold text-success">OUTPERFORM</span></div>
                            <div class="text-gray-600 mt-2"><strong>Key Strength:</strong> Brand loyalty + stable demand.</div>
                            <div class="text-gray-600"><strong>Key Risk:</strong> Commodity RM volatility.</div>
                        </div>
                    </div>
                    <div class="border-l-4 border-voltas pl-4">
                        <h5 class="font-bold text-voltas text-lg">Voltas (Cap Goods)</h5>
                        <div class="text-sm space-y-2 mt-2">
                            <div class="flex justify-between"><span>Overall Rating:</span> <span class="font-bold">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3/5)</span></div>
                            <div class="flex justify-between"><span>Verdict:</span> <span class="font-bold text-yellow-600">IN-LINE</span></div>
                            <div class="text-gray-600 mt-2"><strong>Key Strength:</strong> Revenue scaling + RAC brand.</div>
                            <div class="text-gray-600"><strong>Key Risk:</strong> EPC project risks + fixed pricing.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE 6: COST STRUCTURE -->
        <section id="page-cost-structure" class="page-section">
            <div class="mb-6">
                <div class="text-sm text-gray-500 mb-2">Home > Cost Structure</div>
                <button onclick="showPage('home')" class="text-navy border border-navy px-3 py-1 rounded text-sm hover:bg-navy hover:text-white transition mb-4">‚Üê Back to Home</button>
                <h2 class="text-3xl font-bold text-navy">Cost Structure Analysis ‚Äî All Companies</h2>
                <p class="text-gray-500">FY2021‚ÄìFY2025 | Cost Decomposition | Behaviour Classification | Source: Bloomberg Terminal</p>
            </div>

            <!-- Section 1: Cost Composition -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 1: Cost Composition Overview</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="card p-4">
                        <h4 class="font-bold text-cipla mb-4 text-center">Cipla</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-cs-cipla"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-nestle mb-4 text-center">Nestl√©</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-cs-nestle"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-voltas mb-4 text-center">Voltas</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-cs-voltas"></canvas>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 border-l-4 border-navy p-4 rounded">
                    <h4 class="font-bold text-navy mb-2">What the cost composition tells us:</h4>
                    <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                        <li><strong class="text-cipla">Cipla:</strong> High gross margins (65%+) allow for significant R&D and SG&A investment (Other Expenses ~24%).</li>
                        <li><strong class="text-nestle">Nestl√©:</strong> Balanced structure with moderate COGS (43%) and efficient employee costs (10%), reflecting automated production.</li>
                        <li><strong class="text-voltas">Voltas:</strong> High COGS intensity (~77%) due to project-based nature, leaving thin margins for overheads.</li>
                    </ul>
                </div>
            </div>

            <!-- Section 2: Cost Intensity Table -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 2: Cost Intensity Comparison (FY25)</h3>
                <div class="card p-6 mb-4">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th class="bg-cipla">Cipla</th>
                                <th class="bg-nestle">Nestl√©</th>
                                <th class="bg-voltas">Voltas</th>
                                <th class="bg-navy">Most Efficient?</th>
                            </tr>
                        </thead>
                        <tbody id="table-cost-intensity">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                <div class="insight-box border-navy">
                    <strong>Why the difference?</strong> Pharma (Cipla) relies on IP/R&D, hence high margins but high OpEx. FMCG (Nestl√©) relies on brand/volume, hence balanced costs. Capital Goods (Voltas) relies on execution/materials, hence high COGS.
                </div>
            </div>

            <!-- Section 3: Cost Behaviour -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 3: Cost Behaviour Classification</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="cost-behaviour-panel">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 4: YoY Growth -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 4: YoY Cost Growth Comparison</h3>
                <div class="card p-6">
                    <div class="chart-container">
                        <canvas id="chart-cs-growth"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE 7: BENCHMARKING -->
        <section id="page-benchmarking" class="page-section">
            <div class="mb-6">
                <div class="text-sm text-gray-500 mb-2">Home > Benchmarking</div>
                <button onclick="showPage('home')" class="text-navy border border-navy px-3 py-1 rounded text-sm hover:bg-navy hover:text-white transition mb-4">‚Üê Back to Home</button>
                <h2 class="text-3xl font-bold text-navy">Industry Benchmarking</h2>
                <p class="text-gray-500">Margins | Costs | Profitability Ratios</p>
            </div>
            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded mb-8 text-sm text-yellow-800">
                <strong>‚ö† Note:</strong> Cipla, Nestl√© and Voltas operate in entirely different industries. Direct cross-company comparison of absolute values is not meaningful. Each company is benchmarked exclusively against its own sector average.
            </div>

            <!-- Section 1: Margin Benchmarking -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 1: Margin Benchmarking (FY25)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card p-4">
                        <h4 class="font-bold text-cipla mb-4 text-center">Cipla vs Pharma Avg</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-cipla"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-nestle mb-4 text-center">Nestl√© vs FMCG Avg</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-nestle"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-voltas mb-4 text-center">Voltas vs Cap.Goods Avg</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-voltas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: 5-Year Trend -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 2: 5-Year Gross Margin Trend vs Industry</h3>
                <div class="grid grid-cols-1 gap-6">
                    <div class="card p-4">
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-trend-cipla"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-trend-nestle"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-bm-trend-voltas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Cost Structure vs Industry -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 3: Cost Structure vs Industry Benchmarks</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="bm-cost-structure">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 4: Profitability Ratios -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 4: Profitability Ratios vs Industry</h3>
                <div class="grid grid-cols-1 gap-8" id="bm-ratios">
                    <!-- Populated by JS -->
                </div>
            </div>
        </section>

        <!-- PAGE 8: PRICING ANALYSIS -->
        <section id="page-pricing-analysis" class="page-section">
            <div class="mb-6">
                <div class="text-sm text-gray-500 mb-2">Home > Pricing Analysis</div>
                <button onclick="showPage('home')" class="text-navy border border-navy px-3 py-1 rounded text-sm hover:bg-navy hover:text-white transition mb-4">‚Üê Back to Home</button>
                <h2 class="text-3xl font-bold text-navy">Pricing Discipline & Cost Pass-Through</h2>
                <p class="text-gray-500">Input Cost Pressure | Margin Response | Pricing Strategy</p>
            </div>

            <!-- Section 1: Input Cost Pressure -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 1: Input Cost Pressure Detector</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="pricing-pressure-panel">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 2: Revenue vs COGS Growth -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 2: Revenue vs COGS Growth</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card p-4">
                        <h4 class="font-bold text-cipla mb-4 text-center">Cipla</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-cipla"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-nestle mb-4 text-center">Nestl√©</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-nestle"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-voltas mb-4 text-center">Voltas</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-voltas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Margin Response -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 3: Margin Response to Cost Inflation</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card p-4">
                        <h4 class="font-bold text-cipla mb-4 text-center">Cipla Margin Trend</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-margin-cipla"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-nestle mb-4 text-center">Nestl√© Margin Trend</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-margin-nestle"></canvas>
                        </div>
                    </div>
                    <div class="card p-4">
                        <h4 class="font-bold text-voltas mb-4 text-center">Voltas Margin Trend</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="chart-pa-margin-voltas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 4: Pricing Strategy Table -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 4: Pricing Strategy Comparison</h3>
                <div class="card p-6 overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>Strategy Element</th>
                                <th class="bg-cipla">Cipla</th>
                                <th class="bg-nestle">Nestl√©</th>
                                <th class="bg-voltas">Voltas</th>
                            </tr>
                        </thead>
                        <tbody id="table-pricing-strategy">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- PAGE 9: KPI DASHBOARD -->
        <section id="page-kpi-dashboard" class="page-section">
            <div class="mb-6">
                <div class="text-sm text-gray-500 mb-2">Home > KPI Dashboard</div>
                <button onclick="showPage('home')" class="text-navy border border-navy px-3 py-1 rounded text-sm hover:bg-navy hover:text-white transition mb-4">‚Üê Back to Home</button>
                <h2 class="text-3xl font-bold text-navy">Management Control Dashboard</h2>
                <p class="text-gray-500">Key Performance Indicators | Target Ranges | Warning Thresholds</p>
            </div>

            <!-- Section 1: Selector -->
            <div class="flex gap-4 mb-8 justify-center">
                <button onclick="filterKPI('all')" class="kpi-tab-btn active px-6 py-2 rounded-full border border-navy bg-navy text-white font-bold transition">ALL</button>
                <button onclick="filterKPI('cipla')" class="kpi-tab-btn px-6 py-2 rounded-full border border-cipla text-cipla hover:bg-cipla hover:text-white transition">CIPLA</button>
                <button onclick="filterKPI('nestle')" class="kpi-tab-btn px-6 py-2 rounded-full border border-nestle text-nestle hover:bg-nestle hover:text-white transition">NESTL√â</button>
                <button onclick="filterKPI('voltas')" class="kpi-tab-btn px-6 py-2 rounded-full border border-voltas text-voltas hover:bg-voltas hover:text-white transition">VOLTAS</button>
            </div>

            <!-- Section 2: KPI Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12" id="kpi-grid-container">
                <!-- Populated by JS -->
            </div>

            <!-- Section 3: Industry Challenges -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">SECTION 3: Industry Control Challenges</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="kpi-challenges-panel">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 6: Master Scorecard -->
            <div class="mb-12">
                <h3 class="text-lg font-bold text-navy mb-6 border-l-4 border-navy pl-3">Master Management Accounting Scorecard ‚Äî FY2025</h3>
                <div class="card p-6 overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th class="bg-cipla">Cipla</th>
                                <th class="bg-nestle">Nestl√©</th>
                                <th class="bg-voltas">Voltas</th>
                            </tr>
                        </thead>
                        <tbody id="table-master-scorecard">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer class="bg-navy text-white py-8 border-t-4 border-nestle-gold">
        <div class="max-w-7xl mx-auto px-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-sm font-semibold">Management Accounting ‚Äî C304 | Group Project</div>
            <div class="text-xs text-gray-300 text-center">Data Source: Bloomberg Terminal | Analysis Period: FY2021‚ÄìFY2025 | Values: INR Millions</div>
            <div class="flex gap-3">
                <span class="px-2 py-1 bg-white/10 rounded text-xs">Cipla</span>
                <span class="px-2 py-1 bg-white/10 rounded text-xs">Nestl√©</span>
                <span class="px-2 py-1 bg-white/10 rounded text-xs">Voltas</span>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA SOURCE ---
        const DB = {
            cipla: {
                meta: { name: 'Cipla Limited', ticker: 'NSE: CIPLA', ind: 'Pharma', color: '#00539C' },
                kpi: { rev: '271,454', gm: '65.9%', ebitda: '25.7%', pat: '19.4%' },
                costStructure: {
                    years: ['FY21', 'FY22', 'FY23', 'FY24', 'FY25'],
                    revenue: [189885.2, 216233.6, 224731.8, 254466.3, 271454.0],
                    cogs: [73518.9, 84956.0, 82522.8, 88195.7, 89289.9],
                    emp: [32518.3, 35299.1, 38300.8, 43100.4, 48328.3],
                    da: [10676.6, 10519.5, 11721.1, 10510.2, 11069.5],
                    other: [43034.4, 51850.5, 56437.9, 63534.3, 66579.0],
                    finance: [1607.0, 1063.5, 1095.4, 898.8, 620.1],
                    rd: [7910.5, 11220.0, 11211.7, 11883.0, 12699.6],
                    classifications: [
                        {name: 'COGS', type: 'Variable', just: 'Directly proportional to production volume'},
                        {name: 'Employee', type: 'Semi-Fixed', just: 'Headcount stable but wage inflation varies'},
                        {name: 'D&A', type: 'Fixed', just: 'Asset base depreciation is constant'},
                        {name: 'R&D', type: 'Discretionary', just: 'Strategic investment for future growth'},
                        {name: 'Other', type: 'Mixed', just: 'Includes both fixed admin and variable selling'}
                    ]
                },
                estimation: {
                    high: { year: 'FY25', rev: 271454.0, cost: 92610.9 },
                    low: { year: 'FY21', rev: 189885.2, cost: 76045.7 },
                    vcRate: 0.2031,
                    fc: 37483.3,
                    reg: { 
                        cogs: {b: 0.1871, a: 42116.5, r2: 0.917}, 
                        emp: {b: 0.1931, a: -5158.0, r2: 0.971} 
                    },
                    scenarios: [
                        {rev: 150000, cogs: 70188, emp: 23802, total: 93990, margin: '37.3%'},
                        {rev: 175000, cogs: 74867, emp: 28629, total: 103496, margin: '40.9%'},
                        {rev: 200000, cogs: 79690, emp: 33606, total: 113296, margin: '43.6%'},
                        {rev: 225000, cogs: 84224, emp: 38283, total: 122506, margin: '45.6%'},
                        {rev: 250000, cogs: 88902, emp: 43109, total: 132012, margin: '47.2%'}
                    ]
                },
                margins: {
                    gm: [60.0, 60.4, 62.9, 64.9, 65.9],
                    ebitda: [17.9, 16.6, 18.7, 22.8, 25.8],
                    pat: [12.6, 11.8, 12.6, 16.3, 19.4],
                    volatility: '2.7%',
                    insight: 'Strong margin expansion driven by operational leverage and premium product mix.',
                    benchmark: {
                        gm: {act: '65.9%', ind: '62.1%', peer1: '59.8% (Dr.Reddy)', peer2: '67.2% (Sun)', avg: '63.7%'},
                        ebitda: {act: '25.8%', ind: '25.1%', peer1: '25.4%', peer2: '29.8%', avg: '26.5%'},
                        pat: {act: '19.4%', ind: '19.1%', peer1: '17.3%', peer2: '21.8%', avg: '19.4%'}
                    }
                },
                special: {
                    desc: 'Export Bulk Order from Institutional Buyer at 25% Discount',
                    price: 150.0,
                    varCost: 90.31, // Adjusted to match contribution in PDF table
                    contrib: 59.69,
                    units: 500000,
                    totalContrib: 29843398.88,
                    decision: 'ACCEPT'
                },
                pricing: {
                    years: ['FY22', 'FY23', 'FY24', 'FY25'],
                    revG: [13.9, 3.9, 13.2, 6.7],
                    cogsG: [12.7, -2.6, 6.9, 3.8],
                    insight: 'Selective pass-through; focus on operational leverage. No emergency pricing action required.',
                    strategy: [
                        {metric: 'Revenue Growth YoY', fy22: '13.9%', fy23: '3.9%', fy24: '13.2%', fy25: '6.7%', pressure: 'No', response: 'Volume + mix', decision: 'Controlled price revisions'},
                        {metric: 'COGS Growth YoY', fy22: '12.7%', fy23: '-2.6%', fy24: '6.9%', fy25: '3.8%', pressure: 'No', response: 'Efficiency gains', decision: 'Selective pass-through'},
                        {metric: 'Gross Margin %', fy22: '60.4%', fy23: '62.9%', fy24: '64.9%', fy25: '65.9%', pressure: '-', response: 'Gradual expansion', decision: 'Partial pass-through'},
                        {metric: 'EBITDA Margin %', fy22: '16.6%', fy23: '18.7%', fy24: '22.8%', fy25: '25.8%', pressure: 'Temp compression FY22', response: 'Strong recovery', decision: 'Sustain pricing power'}
                    ]
                },
                dashboard: [
                    {name: 'Gross Margin %', act: '67.1%', target: '60-66%', warn: '<58%', status: 'OK', action: 'Maintain pricing power', type: 'Variable'},
                    {name: 'EBITDA Margin %', act: '25.9%', target: '16-26%', warn: '<14%', status: 'OK', action: 'Reinvest excess margin', type: 'Mixed'},
                    {name: 'COGS / Revenue', act: '32.9%', target: '15-18%', warn: '>20%', status: 'WARN', action: 'Optimize supply chain', type: 'Semi-Fixed'},
                    {name: 'Employee / Rev', act: '17.8%', target: '5-7%', warn: '<4%', status: 'WARN', action: 'Improve productivity', type: 'Discretionary'},
                    {name: 'R&D / Revenue', act: '6.7%', target: '8-14%', warn: '<6%', status: 'WARN', action: 'Increase pipeline inv.', type: 'Fixed'},
                    {name: 'Rev CAGR (5Y)', act: '1.4%', target: '18-22%', warn: '<15%', status: 'WARN', action: 'Expand US portfolio', type: 'Growth'}
                ]
            },
            nestle: {
                meta: { name: 'Nestl√© India', ticker: 'NSE: NESTLEIND', ind: 'FMCG', color: '#C8A84B' },
                kpi: { rev: '200,775', gm: '56.4%', ebitda: '23.8%', pat: '16.0%' },
                costStructure: {
                    years: ['FY19', 'FY20', 'FY21', 'FY22', 'FY25'],
                    revenue: [122952.7, 132901.6, 146649.0, 167895.3, 200775.0],
                    cogs: [52239.2, 56739.1, 63481.8, 77498.6, 87498.0],
                    emp: [12581.7, 15009.5, 15299.4, 16354.6, 20237.1],
                    da: [3701.5, 3703.8, 3910.2, 4030.1, 5399.2],
                    other: [28977.4, 29132.8, 32664.9, 36970.5, 45777.2],
                    licence: [5472.0, 5935.0, 6545.1, 7498.7, 8994.1],
                    finance: [1291.2, 1641.8, 2016.8, 1545.7, 1360.0],
                    classifications: [
                        {name: 'COGS', type: 'Variable', just: 'Raw materials (Milk, Wheat) vary with output'},
                        {name: 'Employee', type: 'Semi-Fixed', just: 'Production staff fixed, overtime variable'},
                        {name: 'D&A', type: 'Fixed', just: 'Factory assets depreciation'},
                        {name: 'Licence Fees', type: 'Variable', just: 'Royalty paid to parent on sales (4.5%)'},
                        {name: 'Finance', type: 'Committed Fixed', just: 'Interest on long-term debt'}
                    ]
                },
                estimation: {
                    high: { year: 'FY25', rev: 200775.0, cost: 87498.0 },
                    low: { year: 'FY19', rev: 122952.7, cost: 52239.2 },
                    vcRate: 0.4531,
                    fc: -3466.7,
                    reg: { 
                        cogs: {b: 0.4695, a: -4924.2, r2: 0.980}, 
                        emp: {b: 0.0873, a: 2437.8, r2: 0.939},
                        licence: {b: 0.0452, a: -76.3, r2: 1.000}
                    },
                    scenarios: [
                        {rev: 150000, cogs: 65503, emp: 15527, total: 81030, margin: '46.0%'},
                        {rev: 175000, cogs: 77241, emp: 17709, total: 94949, margin: '45.7%'}
                    ]
                },
                margins: {
                    gm: [57.5, 57.3, 56.7, 53.8, 56.4],
                    ebitda: [21.8, 22.5, 22.7, 20.6, 21.5],
                    pat: [16.0, 15.7, 14.4, 14.2, 16.0],
                    volatility: '1.5%',
                    insight: 'Margins compressed in FY22 due to commodity inflation, recovered strongly in FY25.',
                    benchmark: {
                        gm: {act: '56.4%', ind: '52.3%', peer1: '53.7% (HUL)', peer2: '43.8% (Brit)', avg: '52.3%'},
                        ebitda: {act: '21.5%', ind: '20.5%', peer1: '23.7%', peer2: '16.3%', avg: '20.5%'},
                        pat: {act: '16.0%', ind: '13.7%', peer1: '15.9%', peer2: '8.9%', avg: '13.7%'}
                    }
                },
                special: {
                    desc: 'Institutional Bulk Export Order (Maggi) at Discount',
                    price: 64.0,
                    varCost: 44.0, // 34.9 + 9.1
                    contrib: 20.0,
                    units: 2000000,
                    totalContrib: 40000000,
                    decision: 'ACCEPT'
                },
                pricing: {
                    years: ['FY20', 'FY21', 'FY22', 'FY25'],
                    revG: [8.1, 10.3, 14.5, 19.6],
                    cogsG: [8.6, 11.9, 22.1, 12.9],
                    insight: 'Grammage reduction strategy + price hike used to combat input pressure.',
                    strategy: [
                        {metric: 'Revenue Growth YoY', fy20: '8.1%', fy21: '10.3%', fy22: '14.5%', fy25: '19.6%', pressure: '-', response: '-', decision: 'Grammage reduction + price hike'},
                        {metric: 'COGS Growth YoY', fy20: '8.6%', fy21: '11.9%', fy22: '22.1%', fy25: '12.9%', pressure: 'FY22: PRESSURE', response: 'Partial price hike', decision: 'Grammage reduction + price hike'},
                        {metric: 'Gross Margin %', fy20: '57.3%', fy21: '56.7%', fy22: '53.8%', fy25: '56.4%', pressure: 'Compressed FY22', response: 'Price increases lagged', decision: 'Grammage reduction + price hike'},
                        {metric: 'EBITDA Margin %', fy20: '23.7%', fy21: '22.6%', fy22: '22.2%', fy25: '23.8%', pressure: 'Vol.moderate', response: 'Cost absorption', decision: 'Grammage reduction + price hike'}
                    ]
                },
                dashboard: [
                    {name: 'Gross Margin %', act: '56.4%', target: '55-60%', warn: '<52%', status: 'OK', action: 'Review hedging', type: 'Variable'},
                    {name: 'EBITDA Margin %', act: '23.8%', target: '22-26%', warn: '<20%', status: 'OK', action: 'Freeze ad spends', type: 'Mixed'},
                    {name: 'COGS / Revenue', act: '43.6%', target: '40-45%', warn: '>48%', status: 'OK', action: 'Supplier diversification', type: 'Variable'},
                    {name: 'Employee / Rev', act: '10.1%', target: '9-12%', warn: '>14%', status: 'OK', action: 'Automate distribution', type: 'Semi-Fixed'},
                    {name: 'Licence Fees', act: '4.5%', target: '4-4.5%', warn: '>5%', status: 'OK', action: 'Renegotiate with parent', type: 'Fixed%'},
                    {name: 'Rev CAGR (5Y)', act: '13.0%', target: '10-14%', warn: '<7%', status: 'OK', action: 'Accelerate NPD', type: 'Growth'}
                ]
            },
            voltas: {
                meta: { name: 'Voltas Limited', ticker: 'NSE: VOLTAS', ind: 'Capital Goods', color: '#C0392B' },
                kpi: { rev: '154,127', gm: '22.4%', ebitda: '8.9%', pat: '5.4%' },
                costStructure: {
                    years: ['FY21', 'FY22', 'FY23', 'FY24', 'FY25'],
                    revenue: [75557.8, 79344.5, 94987.7, 124812.1, 154127.9],
                    cogs: [55784.6, 58966.6, 73781.8, 98140.4, 119603.9],
                    emp: [6016.8, 6443.0, 6672.1, 8118.0, 8900.7],
                    da: [338.9, 372.6, 396.2, 475.9, 617.8],
                    other: [7342.8, 7386.2, 8810.1, 14137.9, 14461.5],
                    provisions: [1400.3, 934.9, 3600.4, 3999.6, 677.3],
                    finance: [261.5, 258.7, 295.9, 558.8, 621.1],
                    classifications: [
                        {name: 'COGS', type: 'Variable', just: 'Project materials and sub-contracting costs'},
                        {name: 'Employee', type: 'Semi-Fixed', just: 'Core engineering team fixed, site labor variable'},
                        {name: 'Provisions', type: 'Discretionary', just: 'Doubtful debt provisions vary by project risk'},
                        {name: 'Other', type: 'Mixed', just: 'Warranty costs and admin overheads'},
                        {name: 'D&A', type: 'Fixed', just: 'Asset-light model'}
                    ]
                },
                estimation: {
                    high: { year: 'FY25', rev: 154127.9, cost: 81259.6 },
                    low: { year: 'FY21', rev: 75557.8, cost: 34369.0 },
                    vcRate: 0.5968,
                    fc: -10723.9,
                    reg: { 
                        cogs: {b: 0.5869, a: -7709.3, r2: 0.991}, 
                        emp: {b: 0.0364, a: 3380.9, r2: 0.980} 
                    },
                    scenarios: [
                        {rev: 100000, cogs: 50979, emp: 7020, total: 57999, margin: '30.0%'},
                        {rev: 130000, cogs: 68585, emp: 8112, total: 76697, margin: '29.0%'},
                        {rev: 154128, cogs: 82745, emp: 8990, total: 91735, margin: '28.5%'},
                        {rev: 175000, cogs: 94994, emp: 9750, total: 104744, margin: '28.1%'},
                        {rev: 200000, cogs: 109666, emp: 10660, total: 120326, margin: '27.8%'}
                    ]
                },
                margins: {
                    gm: [26.2, 25.7, 22.3, 21.4, 22.4],
                    ebitda: [11.6, 10.6, 5.2, 6.0, 8.9],
                    pat: [7.0, 6.4, 1.4, 2.0, 5.4],
                    volatility: '2.2%',
                    insight: 'Margins bottomed in FY23 due to project overruns, recovering in FY25.',
                    benchmark: {
                        gm: {act: '22.4%', ind: '27.5%', peer1: '17.8% (Blue Star)', peer2: '34.2% (Siemens)', avg: '28.3%'},
                        ebitda: {act: '8.9%', ind: '10.7%', peer1: '8.7%', peer2: '11.2%', avg: '10.0%'},
                        pat: {act: '5.4%', ind: '6.9%', peer1: '5.1%', peer2: '7.2%', avg: '6.3%'}
                    }
                },
                special: {
                    desc: 'Government Institutional Bulk AC Order at Below-Market Rate',
                    price: 28000,
                    varCost: 28802.14, // Adjusted to match contribution in PDF table
                    contrib: -802.14,
                    units: 1000,
                    totalContrib: -802136.08,
                    decision: 'REJECT'
                },
                pricing: {
                    years: ['FY22', 'FY23', 'FY24', 'FY25'],
                    revG: [5.0, 19.7, 31.4, 23.5],
                    cogsG: [5.7, 25.1, 33.0, 21.9],
                    insight: 'Fixed-price contract lock-in caused margin compression. Escalation clauses now mandatory.',
                    strategy: [
                        {metric: 'Revenue Growth YoY', fy22: '5.0%', fy23: '19.7%', fy24: '31.4%', fy25: '23.5%', pressure: '-', response: '-', decision: 'Cost escalation clause needed'},
                        {metric: 'COGS Growth YoY', fy22: '5.7%', fy23: '25.1%', fy24: '33.0%', fy25: '21.9%', pressure: 'FY23-24: PRESSURE', response: 'Partial ‚Äî fixed prices', decision: 'Cost escalation clause needed'},
                        {metric: 'Gross Margin %', fy22: '25.7%', fy23: '22.3%', fy24: '21.4%', fy25: '22.4%', pressure: 'Collapsed FY23', response: 'Project losses absorbed', decision: 'Cost escalation clause needed'},
                        {metric: 'EBITDA Margin %', fy22: '10.6%', fy23: '5.2%', fy24: '6.0%', fy25: '8.9%', pressure: 'Volatile', response: 'Fixed-price lock-in', decision: 'Cost escalation clause needed'}
                    ]
                },
                dashboard: [
                    {name: 'Gross Margin %', act: '22.4%', target: '15-22%', warn: '<12%', status: 'OK', action: 'Re-price pending bids', type: 'Variable'},
                    {name: 'EBITDA Margin %', act: '8.9%', target: '8-12%', warn: '<6%', status: 'OK', action: 'Audit project overruns', type: 'Mixed'},
                    {name: 'COGS / Revenue', act: '77.6%', target: '75-82%', warn: '<85%', status: 'OK', action: 'Commodity hedging', type: 'Variable'},
                    {name: 'Employee / Rev', act: '5.8%', target: '5-7%', warn: '>9%', status: 'OK', action: 'Review staffing ratio', type: 'Semi-Fixed'},
                    {name: 'Provisions', act: '0.4%', target: '<1%', warn: '>3%', status: 'OK', action: 'Investigate credit quality', type: 'Risk'},
                    {name: 'Rev CAGR (5Y)', act: '19.5%', target: '15-20%', warn: '<10%', status: 'OK', action: 'Review order book', type: 'Growth'}
                ]
            }
        };

        // --- FILTER HELPERS ---
        const ALL_YEARS = ['FY19', 'FY20', 'FY21', 'FY22', 'FY23', 'FY24', 'FY25'];

        function createYearFilterHTML(chartId, activeYears = []) {
            return `
                <div class="flex flex-wrap gap-2 mb-4 justify-center" id="filter-${chartId}">
                    ${ALL_YEARS.map(y => `
                        <button onclick="toggleChartYear('${chartId}', '${y}', this)" 
                                class="filter-btn px-3 py-1 text-xs rounded-full border ${activeYears.includes(y) ? 'active' : ''}">
                            ${y}
                        </button>
                    `).join('')}
                </div>
            `;
        }

        function toggleChartYear(chartId, year, btn) {
            btn.classList.toggle('active');
            
            const container = document.getElementById(`filter-${chartId}`);
            const activeButtons = container.querySelectorAll('.filter-btn.active');
            const activeYears = Array.from(activeButtons).map(b => b.innerText.trim());
            
            const chart = Chart.getChart(chartId);
            if (!chart || !chart._originalData) return;

            // Filter logic
            const indices = chart._originalData.labels
                .map((lbl, idx) => activeYears.includes(lbl) ? idx : -1)
                .filter(idx => idx !== -1);

            chart.data.labels = indices.map(i => chart._originalData.labels[i]);
            chart.data.datasets.forEach((ds, dsIdx) => {
                ds.data = indices.map(i => chart._originalData.datasets[dsIdx].data[i]);
                // Handle background colors if array (for bar charts)
                if (Array.isArray(chart._originalData.datasets[dsIdx].backgroundColor)) {
                    ds.backgroundColor = indices.map(i => chart._originalData.datasets[dsIdx].backgroundColor[i]);
                }
            });

            chart.update();
        }

        function normalizeData(years, data) {
            // Returns array of length 7 (FY19-FY25) with values or null
            return ALL_YEARS.map(y => {
                const idx = years.indexOf(y);
                return idx !== -1 ? data[idx] : null;
            });
        }

        // --- NAVIGATION LOGIC ---
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // Show selected page
            const page = document.getElementById(`page-${pageId}`);
            if (page) page.classList.add('active');
            
            const nav = document.getElementById(`nav-${pageId}`);
            if (nav) nav.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);

            // Trigger chart redraws if needed
            if (pageId === 'industry') renderIndustryCharts();
            if (pageId === 'cost-structure') initCostStructurePage();
            if (pageId === 'benchmarking') initBenchmarkingPage();
            if (pageId === 'pricing-analysis') initPricingAnalysisPage();
            if (pageId === 'kpi-dashboard') initKPIDashboardPage();
        }

        // --- NEW PAGE INITIALIZERS ---
        
        function initCostStructurePage() {
            // Section 1: Stacked Bar Charts
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const d = DB[key];
                const ctx = document.getElementById(`chart-cs-${key}`);
                if (ctx && !Chart.getChart(ctx)) {
                    const datasets = d.costStructure.years.map((yr, i) => {
                        const rev = d.costStructure.revenue[i];
                        return {
                            cogs: (d.costStructure.cogs[i] / rev * 100),
                            emp: (d.costStructure.emp[i] / rev * 100),
                            da: (d.costStructure.da[i] / rev * 100),
                            other: (d.costStructure.other[i] / rev * 100)
                        };
                    });
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: d.costStructure.years,
                            datasets: [
                                { label: 'COGS %', data: datasets.map(x => x.cogs), backgroundColor: '#DC3545' },
                                { label: 'Employee %', data: datasets.map(x => x.emp), backgroundColor: '#FFC107' },
                                { label: 'D&A %', data: datasets.map(x => x.da), backgroundColor: '#0D6EFD' },
                                { label: 'Other %', data: datasets.map(x => x.other), backgroundColor: '#198754' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, max: 100 } } }
                    });
                }
            });

            // Section 2: Cost Intensity Table
            const tbody = document.getElementById('table-cost-intensity');
            if (tbody && tbody.children.length === 0) {
                const metrics = [
                    { name: 'COGS / Revenue', key: 'cogs', format: '%' },
                    { name: 'Employee / Revenue', key: 'emp', format: '%' },
                    { name: 'D&A / Revenue', key: 'da', format: '%' },
                    { name: 'Other / Revenue', key: 'other', format: '%' },
                    { name: 'Gross Margin %', key: 'gm', format: '%', higherIsBetter: true },
                    { name: 'EBITDA Margin %', key: 'ebitda', format: '%', higherIsBetter: true }
                ];
                
                tbody.innerHTML = metrics.map(m => {
                    const vals = ['cipla', 'nestle', 'voltas'].map(k => {
                        if (m.key === 'gm' || m.key === 'ebitda') return parseFloat(DB[k].kpi[m.key]);
                        // Calc last year ratio
                        const d = DB[k].costStructure;
                        const idx = d.years.length - 1;
                        return (d[m.key][idx] / d.revenue[idx] * 100);
                    });
                    
                    // Find best
                    const bestVal = m.higherIsBetter ? Math.max(...vals) : Math.min(...vals);
                    const bestIdx = vals.indexOf(bestVal);
                    const winner = ['Cipla', 'Nestl√©', 'Voltas'][bestIdx];

                    return `
                        <tr>
                            <td>${m.name}</td>
                            ${vals.map((v, i) => `<td class="${i === bestIdx ? 'text-success font-bold' : ''}">${v.toFixed(1)}%</td>`).join('')}
                            <td class="text-success font-bold">‚úì ${winner}</td>
                        </tr>
                    `;
                }).join('');
            }

            // Section 3: Cost Behaviour
            const panel = document.getElementById('cost-behaviour-panel');
            if (panel && panel.children.length === 0) {
                panel.innerHTML = ['cipla', 'nestle', 'voltas'].map(key => `
                    <div class="card p-4 border-t-4" style="border-color: ${DB[key].meta.color}">
                        <h4 class="font-bold text-navy mb-4">${DB[key].meta.name}</h4>
                        <div class="space-y-3">
                            ${DB[key].costStructure.classifications.map(c => {
                                let badgeColor = 'bg-gray-500';
                                if(c.type === 'Variable') badgeColor = 'bg-blue-600';
                                if(c.type === 'Semi-Fixed') badgeColor = 'bg-orange-500';
                                if(c.type === 'Discretionary') badgeColor = 'bg-purple-600';
                                return `
                                    <div class="mb-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold text-sm">${c.name}</span>
                                            <span class="text-xs text-white px-2 py-0.5 rounded ${badgeColor}">${c.type}</span>
                                        </div>
                                        <div class="text-xs text-gray-500 italic">${c.just}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `).join('');
            }

            // Section 4: YoY Growth
            const ctxGrowth = document.getElementById('chart-cs-growth');
            if (ctxGrowth && !Chart.getChart(ctxGrowth)) {
                // Common years: FY22, FY23, FY24, FY25 (Nestle missing FY23/24 in source for growth calc, using available)
                const years = ['FY22', 'FY23', 'FY24', 'FY25'];
                
                // Inject Filter
                if (!document.getElementById('filter-chart-cs-growth')) {
                    ctxGrowth.parentElement.insertAdjacentHTML('beforebegin', createYearFilterHTML('chart-cs-growth', years));
                }

                // Helper to get growth or null
                const getGrowth = (key, type) => {
                    // Map available years in pricing object to common years
                    return years.map(y => {
                        const idx = DB[key].pricing.years.indexOf(y);
                        return idx !== -1 ? DB[key].pricing[type][idx] : 0;
                    });
                };

                const chart = new Chart(ctxGrowth, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [
                            { label: 'Cipla COGS Growth', data: getGrowth('cipla', 'cogsG'), backgroundColor: '#00539C' },
                            { label: 'Nestl√© COGS Growth', data: getGrowth('nestle', 'cogsG'), backgroundColor: '#C8A84B' },
                            { label: 'Voltas COGS Growth', data: getGrowth('voltas', 'cogsG'), backgroundColor: '#C0392B' },
                            // Lines for Revenue
                            { label: 'Cipla Rev Growth', data: getGrowth('cipla', 'revG'), type: 'line', borderColor: '#00539C', borderDash: [5,5], tension: 0.4 },
                            { label: 'Nestl√© Rev Growth', data: getGrowth('nestle', 'revG'), type: 'line', borderColor: '#C8A84B', borderDash: [5,5], tension: 0.4 },
                            { label: 'Voltas Rev Growth', data: getGrowth('voltas', 'revG'), type: 'line', borderColor: '#C0392B', borderDash: [5,5], tension: 0.4 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                chart._originalData = JSON.parse(JSON.stringify(chart.data));
            }
        }

        function initBenchmarkingPage() {
            // Section 1: Margin Benchmarking
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const ctx = document.getElementById(`chart-bm-${key}`);
                if (ctx && !Chart.getChart(ctx)) {
                    // Data from Industry Page logic
                    let d, avg;
                    if (key === 'cipla') { d = [65.9, 25.7, 19.4]; avg = [62.0, 22.5, 17.0]; }
                    if (key === 'nestle') { d = [56.4, 23.8, 16.0]; avg = [55.0, 22.0, 14.5]; }
                    if (key === 'voltas') { d = [22.4, 8.9, 5.4]; avg = [16.0, 8.5, 4.8]; }
                    
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Gross Margin', 'EBITDA Margin', 'PAT Margin'],
                            datasets: [
                                { label: DB[key].meta.name, data: d, backgroundColor: DB[key].meta.color },
                                { label: 'Industry Avg', data: avg, backgroundColor: '#ADB5BD' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                }
            });

            // Section 2: 5-Year Trend
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const ctx = document.getElementById(`chart-bm-trend-${key}`);
                if (ctx && !Chart.getChart(ctx)) {
                    // Mock industry trend data (flat or slight growth for viz)
                    const indTrend = DB[key].margins.gm.map(v => v * 0.9); // Placeholder logic for industry line
                    
                    const labels = key === 'nestle' ? ['FY21', 'FY22', 'FY25'] : DB[key].costStructure.years;

                    // Inject Filter
                    if (!document.getElementById(`filter-chart-bm-trend-${key}`)) {
                        ctx.parentElement.insertAdjacentHTML('beforebegin', createYearFilterHTML(`chart-bm-trend-${key}`, labels));
                    }

                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                { label: `${DB[key].meta.name} GM%`, data: DB[key].margins.gm, borderColor: DB[key].meta.color, tension: 0.3 },
                                { label: 'Industry Avg GM%', data: indTrend, borderColor: '#ADB5BD', borderDash: [5,5], tension: 0.3 }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                    chart._originalData = JSON.parse(JSON.stringify(chart.data));
                }
            });

            // Section 3: Cost Structure vs Industry
            const csContainer = document.getElementById('bm-cost-structure');
            if (csContainer && csContainer.children.length === 0) {
                csContainer.innerHTML = ['cipla', 'nestle', 'voltas'].map(key => {
                    // Mock industry averages for cost structure
                    const d = DB[key].costStructure;
                    const lastIdx = d.years.length - 1;
                    const rev = d.revenue[lastIdx];
                    const cogs = (d.cogs[lastIdx] / rev * 100).toFixed(1);
                    const emp = (d.emp[lastIdx] / rev * 100).toFixed(1);
                    
                    // Industry benchmarks (hardcoded based on typical sector profiles)
                    const ind = key === 'cipla' ? {cogs: 38.0, emp: 16.0} : 
                               key === 'nestle' ? {cogs: 55.0, emp: 8.0} : 
                               {cogs: 75.0, emp: 6.0};

                    return `
                        <div class="card p-4 border-t-4" style="border-color: ${DB[key].meta.color}">
                            <h4 class="font-bold text-navy mb-4">${DB[key].meta.name}</h4>
                            <table>
                                <thead><tr><th>Metric</th><th>Act</th><th>Ind</th><th>Status</th></tr></thead>
                                <tbody>
                                    <tr>
                                        <td>COGS %</td>
                                        <td>${cogs}%</td>
                                        <td>${ind.cogs}%</td>
                                        <td class="${cogs < ind.cogs ? 'text-success' : 'text-warning'}">${cogs < ind.cogs ? '‚úì' : '‚úó'}</td>
                                    </tr>
                                    <tr>
                                        <td>Emp %</td>
                                        <td>${emp}%</td>
                                        <td>${ind.emp}%</td>
                                        <td class="${emp > ind.emp ? 'text-warning' : 'text-success'}">${emp > ind.emp ? 'High' : 'OK'}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `;
                }).join('');
            }
            
            // Section 4: Profitability Ratios
            const ratiosContainer = document.getElementById('bm-ratios');
            if (ratiosContainer && ratiosContainer.children.length === 0) {
                ratiosContainer.innerHTML = ['cipla', 'nestle', 'voltas'].map(key => {
                    // Hardcoded ratios from Industry_Comparison.xlsx (simulated)
                    const ratios = [
                        { name: 'ROE', val: key==='nestle'?'80%':key==='cipla'?'14%':'11%', ind: key==='nestle'?'35%':'12%', signal: '‚ñ≤' },
                        { name: 'Asset Turnover', val: key==='voltas'?'1.8x':'0.9x', ind: '1.1x', signal: key==='voltas'?'‚ñ≤':'‚ñº' },
                        { name: 'EBITDA/Assets', val: key==='cipla'?'18%':'22%', ind: '15%', signal: '‚ñ≤' }
                    ];
                    
                    return `
                        <div class="card p-4">
                            <h4 class="font-bold mb-2" style="color: ${DB[key].meta.color}">${DB[key].meta.name} vs Industry Ratios</h4>
                            <table>
                                <thead><tr><th>Ratio</th><th>Company</th><th>Industry</th><th>Signal</th></tr></thead>
                                <tbody>
                                    ${ratios.map(r => `
                                        <tr>
                                            <td>${r.name}</td>
                                            <td class="font-bold">${r.val}</td>
                                            <td>${r.ind}</td>
                                            <td class="${r.signal === '‚ñ≤' ? 'text-success' : 'text-warning'}">${r.signal}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }).join('');
            }
        }

        function initPricingAnalysisPage() {
            // Section 1: Pressure Detector
            const panel = document.getElementById('pricing-pressure-panel');
            if (panel && panel.children.length === 0) {
                panel.innerHTML = ['cipla', 'nestle', 'voltas'].map(key => {
                    const d = DB[key].pricing;
                    // Check pressure years
                    const rows = d.years.map((y, i) => {
                        const pressure = d.cogsG[i] > d.revG[i];
                        return `
                            <div class="flex justify-between items-center p-2 rounded mb-1 ${pressure ? 'bg-red-50 border border-red-100' : 'bg-green-50 border border-green-100'}">
                                <span class="text-xs font-bold">${y}</span>
                                <span class="text-xs ${pressure ? 'text-red-700' : 'text-green-700'}">
                                    ${pressure ? '‚ö† PRESSURE' : '‚úì STABLE'}
                                </span>
                            </div>
                        `;
                    }).join('');
                    
                    return `
                        <div class="card p-4 border-t-4" style="border-color: ${DB[key].meta.color}">
                            <h4 class="font-bold text-navy mb-4">${DB[key].meta.name}</h4>
                            ${rows}
                        </div>
                    `;
                }).join('');
            }

            // Section 2: Rev vs COGS Charts
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const ctx = document.getElementById(`chart-pa-${key}`);
                if (ctx && !Chart.getChart(ctx)) {
                    const d = DB[key].pricing;
                    
                    // Inject Filter
                    if (!document.getElementById(`filter-chart-pa-${key}`)) {
                        ctx.parentElement.insertAdjacentHTML('beforebegin', createYearFilterHTML(`chart-pa-${key}`, d.years));
                    }

                    const bgColors = d.cogsG.map((c, i) => c > d.revG[i] ? '#DC3545' : '#198754');
                    const chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: d.years,
                            datasets: [
                                { label: 'Rev Growth', data: d.revG, backgroundColor: '#1B2A4A' },
                                { label: 'COGS Growth', data: d.cogsG, backgroundColor: bgColors }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                    chart._originalData = JSON.parse(JSON.stringify(chart.data));
                }
            });

            // Section 3: Margin Response
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const ctx = document.getElementById(`chart-pa-margin-${key}`);
                if (ctx && !Chart.getChart(ctx)) {
                    const d = DB[key].margins;
                    const labels = key === 'nestle' ? ['FY21', 'FY22', 'FY25'] : DB[key].costStructure.years;
                    
                    // Inject Filter
                    if (!document.getElementById(`filter-chart-pa-margin-${key}`)) {
                        ctx.parentElement.insertAdjacentHTML('beforebegin', createYearFilterHTML(`chart-pa-margin-${key}`, labels));
                    }

                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                { label: 'Gross Margin %', data: d.gm, borderColor: '#198754', tension: 0.3 },
                                { label: 'EBITDA Margin %', data: d.ebitda, borderColor: '#0D6EFD', tension: 0.3 }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                    chart._originalData = JSON.parse(JSON.stringify(chart.data));
                }
            });

            // Section 4: Strategy Table
            const tbody = document.getElementById('table-pricing-strategy');
            if (tbody && tbody.children.length === 0) {
                const rows = [
                    { name: 'Pricing Power', c: 'HIGH', n: 'HIGH', v: 'MODERATE' },
                    { name: 'Primary Lever', c: 'Product Mix', n: 'Grammage Reduction', v: 'Volume' },
                    { name: 'Pass-Through', c: 'Selective', n: 'Lagged', v: 'Difficult' },
                    { name: 'COGS CAGR > Rev?', c: 'NO', n: 'YES (Slight)', v: 'YES' }
                ];
                tbody.innerHTML = rows.map(r => `
                    <tr>
                        <td>${r.name}</td>
                        <td>${r.c}</td>
                        <td>${r.n}</td>
                        <td>${r.v}</td>
                    </tr>
                `).join('');
            }
        }

        function initKPIDashboardPage() {
            // Populate KPI Grid
            const container = document.getElementById('kpi-grid-container');
            if (container && container.children.length === 0) {
                ['cipla', 'nestle', 'voltas'].forEach(key => {
                    const d = DB[key];
                    d.dashboard.forEach(k => {
                        const card = document.createElement('div');
                        card.className = `card p-5 border-t-4 kpi-card kpi-${key}`;
                        card.style.borderColor = d.meta.color;
                        card.innerHTML = `
                            <div class="flex justify-between mb-2">
                                <span class="text-xs font-bold text-gray-400 uppercase">${k.name}</span>
                                <span class="text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 border">${k.type}</span>
                            </div>
                            <div class="text-3xl font-bold text-navy mb-3">${k.act}</div>
                            <div class="flex gap-2 mb-3">
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded">Target: ${k.target}</span>
                                <span class="text-xs px-2 py-1 bg-red-100 text-red-800 rounded">Warn: ${k.warn}</span>
                            </div>
                            <div class="flex justify-between items-center border-t border-gray-100 pt-3">
                                <span class="kpi-pill ${k.status === 'OK' ? 'kpi-ok' : 'kpi-warn'}">${k.status}</span>
                                <span class="text-xs text-gray-500 italic text-right max-w-[60%]">${k.action}</span>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                });
            }

            // Section 3: Industry Challenges
            const challengesPanel = document.getElementById('kpi-challenges-panel');
            if (challengesPanel && challengesPanel.children.length === 0) {
                const challenges = {
                    cipla: ['US Generic Price Erosion', 'USFDA Regulatory Compliance', 'R&D Cost Escalation'],
                    nestle: ['Commodity Inflation (Milk/Wheat)', 'Rural Demand Slowdown', 'Competition from D2C Brands'],
                    voltas: ['Competitive Intensity in ACs', 'Project Execution Delays', 'Input Cost Volatility']
                };
                
                challengesPanel.innerHTML = ['cipla', 'nestle', 'voltas'].map(key => `
                    <div class="card p-4 border-t-4" style="border-color: ${DB[key].meta.color}">
                        <h4 class="font-bold text-navy mb-4">${DB[key].meta.name} Challenges</h4>
                        <ul class="space-y-2">
                            ${challenges[key].map(c => `
                                <li class="flex items-start gap-2 text-sm">
                                    <span class="text-warning font-bold">‚ö†</span>
                                    <span>${c}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `).join('');
            }

            // Master Scorecard
            const tbody = document.getElementById('table-master-scorecard');
            if (tbody && tbody.children.length === 0) {
                // Clone from Industry page logic
                tbody.innerHTML = `
                    <tr>
                        <td>Overall Rating</td>
                        <td class="text-success font-bold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</td>
                        <td class="text-success font-bold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4/5)</td>
                        <td class="text-yellow-600 font-bold">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3/5)</td>
                    </tr>
                    <tr>
                        <td>Verdict</td>
                        <td><span class="kpi-pill kpi-ok">OUTPERFORM</span></td>
                        <td><span class="kpi-pill kpi-ok">OUTPERFORM</span></td>
                        <td><span class="kpi-pill bg-yellow-100 text-yellow-800">IN-LINE</span></td>
                    </tr>
                `;
            }
        }

        function filterKPI(filter) {
            // Update buttons
            document.querySelectorAll('.kpi-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-navy', 'text-white');
                if (btn.innerText.toLowerCase() === filter || (filter === 'all' && btn.innerText === 'ALL')) {
                    btn.classList.add('active', 'bg-navy', 'text-white');
                }
            });

            // Filter cards
            document.querySelectorAll('.kpi-card').forEach(card => {
                if (filter === 'all') {
                    card.style.display = 'block';
                } else {
                    if (card.classList.contains(`kpi-${filter}`)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // --- NAVIGATION LOGIC ---

        // --- COMPANY PAGE BUILDER ---
        function buildCompanyPages() {
            const container = document.getElementById('company-page-container');
            
            ['cipla', 'nestle', 'voltas'].forEach(key => {
                const d = DB[key];
                const section = document.createElement('section');
                section.id = `page-${key}`;
                section.className = 'page-section';
                
                section.innerHTML = `
                    <div class="mb-8 border-b-4" style="border-color: ${d.meta.color}">
                        <h2 class="text-3xl font-bold text-navy">${d.meta.name}</h2>
                        <div class="flex gap-4 text-sm text-gray-500 mt-2 mb-4">
                            <span>${d.meta.ticker}</span>
                            <span>‚Ä¢</span>
                            <span>${d.meta.ind}</span>
                        </div>
                        <div class="flex gap-4 mb-6">
                            <div class="bg-white border border-gray-border px-4 py-2 rounded shadow-sm">
                                <div class="text-xs text-gray-400 uppercase">FY25 Revenue</div>
                                <div class="text-lg font-bold text-navy">‚Çπ${d.kpi.rev} Mn</div>
                            </div>
                            <div class="bg-white border border-gray-border px-4 py-2 rounded shadow-sm">
                                <div class="text-xs text-gray-400 uppercase">Gross Margin</div>
                                <div class="text-lg font-bold text-success">${d.kpi.gm}</div>
                            </div>
                            <div class="bg-white border border-gray-border px-4 py-2 rounded shadow-sm">
                                <div class="text-xs text-gray-400 uppercase">EBITDA Margin</div>
                                <div class="text-lg font-bold text-success">${d.kpi.ebitda}</div>
                            </div>
                            <div class="bg-white border border-gray-border px-4 py-2 rounded shadow-sm">
                                <div class="text-xs text-gray-400 uppercase">PAT Margin</div>
                                <div class="text-lg font-bold text-success">${d.kpi.pat}</div>
                            </div>
                        </div>
                    </div>

                    <!-- TABS -->
                    <div class="flex border-b border-gray-border mb-8 overflow-x-auto">
                        <button class="tab-btn active" onclick="switchTab('${key}', 1)">1. Cost Structure</button>
                        <button class="tab-btn" onclick="switchTab('${key}', 2)">2. Cost Estimation</button>
                        <button class="tab-btn" onclick="switchTab('${key}', 3)">3. Margin Analysis</button>
                        <button class="tab-btn" onclick="switchTab('${key}', 4)">4. Special Order</button>
                        <button class="tab-btn" onclick="switchTab('${key}', 5)">5. Pricing</button>
                        <button class="tab-btn" onclick="switchTab('${key}', 6)">6. KPI Dashboard</button>
                    </div>

                    <!-- TAB CONTENTS -->
                    <div id="${key}-tab-1" class="tab-content active">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div class="card p-6">
                                 <h4 class="font-bold text-navy mb-4">Cost Components % of Revenue</h4>
                                 ${createYearFilterHTML(`chart-${key}-structure`, d.costStructure.years)}
                                 <div class="chart-container">
                                     <canvas id="chart-${key}-structure"></canvas>
                                 </div>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-navy mb-4">Cost Classification</h4>
                                <div class="space-y-3">
                                    ${d.costStructure.classifications.map(c => `
                                        <div class="flex items-start gap-3 p-3 bg-gray-50 rounded">
                                            <span class="text-xs font-bold uppercase px-2 py-1 bg-white border rounded text-navy w-24 text-center shrink-0">${c.type}</span>
                                            <div>
                                                <div class="font-bold text-sm text-navy">${c.name}</div>
                                                <div class="text-xs text-gray-500">${c.just}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Cost Table (Added per user request) -->
                        <div class="card p-6 mb-8">
                            <h4 class="font-bold text-navy mb-4">Detailed Cost Structure (Absolute Values in INR Mn)</h4>
                            <div class="overflow-x-auto">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Line Item</th>
                                            ${d.costStructure.years.map(y => `<th>${y}</th>`).join('')}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>Revenue</td>${d.costStructure.revenue.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>
                                        <tr><td>COGS</td>${d.costStructure.cogs.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>
                                        <tr><td>Employee</td>${d.costStructure.emp.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>
                                        <tr><td>D&A</td>${d.costStructure.da.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>
                                        <tr><td>Other Expenses</td>${d.costStructure.other.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>
                                        ${d.costStructure.licence ? `<tr><td>Licence Fees</td>${d.costStructure.licence.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>` : ''}
                                        ${d.costStructure.finance ? `<tr><td>Finance Costs</td>${d.costStructure.finance.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>` : ''}
                                        ${d.costStructure.rd ? `<tr><td>R&D Expenses</td>${d.costStructure.rd.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>` : ''}
                                        ${d.costStructure.provisions ? `<tr><td>Provisions</td>${d.costStructure.provisions.map(v => `<td>${v.toLocaleString()}</td>`).join('')}</tr>` : ''}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="${key}-tab-2" class="tab-content hidden">
                        <!-- DETAILED ESTIMATION FOR ALL COMPANIES -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div class="card p-6">
                                <h4 class="font-bold text-navy mb-4">Method 1: High-Low Method</h4>
                                <table class="mb-4 text-sm">
                                    <tr class="bg-gray-50 font-semibold"><td>Step</td><td>Revenue</td><td>COGS</td></tr>
                                    <tr><td>HIGH (${d.estimation.high.year})</td><td>${d.estimation.high.rev.toLocaleString()}</td><td>${d.estimation.high.cost.toLocaleString()}</td></tr>
                                    <tr><td>LOW (${d.estimation.low.year})</td><td>${d.estimation.low.rev.toLocaleString()}</td><td>${d.estimation.low.cost.toLocaleString()}</td></tr>
                                </table>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="p-3 bg-blue-50 rounded border border-blue-100">
                                        <div class="text-xs text-gray-500">Variable Rate (b)</div>
                                        <div class="text-xl font-mono font-bold text-navy">${d.estimation.vcRate}</div>
                                    </div>
                                    <div class="p-3 bg-blue-50 rounded border border-blue-100">
                                        <div class="text-xs text-gray-500">Fixed Cost (a)</div>
                                        <div class="text-xl font-mono font-bold text-navy">‚Çπ${d.estimation.fc.toLocaleString()}</div>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 italic">Total Cost = ${d.estimation.fc} + (${d.estimation.vcRate} √ó Revenue)</p>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-navy mb-4">Method 2: Regression Analysis</h4>
                                <div class="space-y-4">
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-600 mb-2">COGS Regression Stats</h5>
                                        <div class="grid grid-cols-3 gap-2 text-center">
                                            <div class="bg-gray-50 p-2 rounded"><div class="text-xs text-gray-400">Slope</div><div class="font-bold">${d.estimation.reg.cogs.b}</div></div>
                                            <div class="bg-gray-50 p-2 rounded"><div class="text-xs text-gray-400">Intercept</div><div class="font-bold">${d.estimation.reg.cogs.a}</div></div>
                                            <div class="bg-gray-50 p-2 rounded"><div class="text-xs text-gray-400">R-Squared</div><div class="font-bold text-success">${d.estimation.reg.cogs.r2}</div></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-600 mb-2">Cost Prediction Scenarios</h5>
                                        <table class="text-xs w-full">
                                            <thead><tr class="bg-gray-100"><th>Rev Scenario</th><th>Pred Total Cost</th><th>Est Margin</th></tr></thead>
                                            <tbody>
                                                ${d.estimation.scenarios.map(s => `
                                                    <tr>
                                                        <td class="p-2 border-b">‚Çπ${s.rev.toLocaleString()}</td>
                                                        <td class="p-2 border-b font-bold">‚Çπ${s.total.toLocaleString()}</td>
                                                        <td class="p-2 border-b text-success">${s.margin}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="${key}-tab-3" class="tab-content hidden">
                        <div class="card p-6 mb-8">
                            <h4 class="font-bold text-navy mb-4">Margin Trend Analysis (FY19-FY25)</h4>
                            ${createYearFilterHTML(`chart-${key}-margin`, key === 'nestle' ? ['FY19', 'FY20', 'FY21', 'FY22', 'FY25'] : d.costStructure.years)}
                            <div class="chart-container">
                                <canvas id="chart-${key}-margin"></canvas>
                            </div>
                            <div class="insight-box mt-6" style="border-color: ${d.meta.color}">
                                <strong>üí° Management Insight:</strong> ${d.margins.insight}
                            </div>
                        </div>
                        
                        <!-- INDUSTRY BENCHMARK TABLE (FOR ALL COMPANIES) -->
                        <div class="card p-6 mb-8">
                            <h4 class="font-bold text-navy mb-4">${d.meta.ind} Industry Benchmark (FY25)</h4>
                            <table>
                                <thead>
                                    <tr><th>Metric</th><th>${d.meta.name}</th><th>Industry Avg</th><th>Peer 1</th><th>Peer 2</th><th>Mkt Avg</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Gross Margin %</td><td class="font-bold" style="color:${d.meta.color}">${d.margins.benchmark.gm.act}</td><td>${d.margins.benchmark.gm.ind}</td><td>${d.margins.benchmark.gm.peer1 || '-'}</td><td>${d.margins.benchmark.gm.peer2 || '-'}</td><td>${d.margins.benchmark.gm.avg}</td></tr>
                                    <tr><td>EBITDA Margin %</td><td class="font-bold" style="color:${d.meta.color}">${d.margins.benchmark.ebitda.act}</td><td>${d.margins.benchmark.ebitda.ind}</td><td>${d.margins.benchmark.ebitda.peer1 || '-'}</td><td>${d.margins.benchmark.ebitda.peer2 || '-'}</td><td>${d.margins.benchmark.ebitda.avg}</td></tr>
                                    <tr><td>PAT Margin %</td><td class="font-bold" style="color:${d.meta.color}">${d.margins.benchmark.pat.act}</td><td>${d.margins.benchmark.pat.ind}</td><td>${d.margins.benchmark.pat.peer1 || '-'}</td><td>${d.margins.benchmark.pat.peer2 || '-'}</td><td>${d.margins.benchmark.pat.avg}</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="${key}-tab-4" class="tab-content hidden">
                        <div class="card p-6 max-w-4xl mx-auto">
                            <div class="flex justify-between items-start border-b border-gray-border pb-4 mb-6">
                                <div>
                                    <h4 class="font-bold text-navy text-xl">Special Order Decision Analysis</h4>
                                    <p class="text-gray-500 text-sm mt-1">${d.special.desc}</p>
                                </div>
                                <div class="text-right">
                                    <span class="block text-xs text-gray-400 uppercase">Recommendation</span>
                                    <span class="font-bold text-lg ${d.special.decision === 'ACCEPT' ? 'text-success' : 'text-warning'}">${d.special.decision}</span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                <!-- Quantitative Analysis -->
                                <div class="bg-gray-50 p-5 rounded border border-gray-200">
                                    <h5 class="font-bold text-navy mb-4 border-b border-gray-300 pb-2">Quantitative Analysis (Incremental)</h5>
                                    <div class="space-y-3 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Special Price / Unit</span>
                                            <span class="font-bold">‚Çπ${d.special.price}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Less: Variable Cost / Unit</span>
                                            <span class="text-red-600">-‚Çπ${d.special.varCost}</span>
                                        </div>
                                        <div class="flex justify-between border-t border-gray-300 pt-2">
                                            <span class="font-bold text-navy">Contribution / Unit</span>
                                            <span class="font-bold ${d.special.contrib > 0 ? 'text-success' : 'text-danger'}">‚Çπ${d.special.contrib}</span>
                                        </div>
                                        <div class="flex justify-between mt-4">
                                            <span class="text-gray-600">Total Units</span>
                                            <span>${d.special.units.toLocaleString()}</span>
                                        </div>
                                        <div class="flex justify-between bg-white p-2 rounded border border-gray-200 mt-2">
                                            <span class="font-bold text-navy">Total Incremental Profit</span>
                                            <span class="font-bold ${d.special.totalContrib > 0 ? 'text-success' : 'text-danger'}">‚Çπ${d.special.totalContrib.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Qualitative Analysis -->
                                <div>
                                    <h5 class="font-bold text-navy mb-4 border-b border-gray-200 pb-2">Qualitative Strategic Factors</h5>
                                    <ul class="space-y-3 text-sm text-gray-700">
                                        <li class="flex gap-2">
                                            <span class="text-blue-600 font-bold">1.</span>
                                            <span><strong>Capacity Utilization:</strong> Is there idle capacity to fulfill this order without displacing regular sales? <span class="text-gray-500 italic">(Assumption: Yes)</span></span>
                                        </li>
                                        <li class="flex gap-2">
                                            <span class="text-blue-600 font-bold">2.</span>
                                            <span><strong>Channel Conflict:</strong> Will selling at a discount cannibalize existing market share or anger distributors? <span class="text-gray-500 italic">(Risk: Moderate)</span></span>
                                        </li>
                                        <li class="flex gap-2">
                                            <span class="text-blue-600 font-bold">3.</span>
                                            <span><strong>Long-term Potential:</strong> Does this open a new market segment (e.g., Institutional/Govt) for future growth?</span>
                                        </li>
                                        <li class="flex gap-2">
                                            <span class="text-blue-600 font-bold">4.</span>
                                            <span><strong>Fixed Cost Coverage:</strong> Even with lower margins, positive contribution helps cover fixed overheads.</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 border-l-4 border-blue-600 p-4 text-sm text-blue-800">
                                <strong>Conclusion:</strong> Since the special price (‚Çπ${d.special.price}) covers the variable cost (‚Çπ${d.special.varCost}) and generates a positive contribution of ‚Çπ${d.special.contrib}/unit, the order is financially viable in the short run, provided it does not displace higher-margin regular sales.
                            </div>
                        </div>
                    </div>

                    <div id="${key}-tab-5" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div class="card p-6">
                                <h4 class="font-bold text-navy mb-4">Revenue vs COGS Growth</h4>
                                ${createYearFilterHTML(`chart-${key}-pricing`, d.pricing.years)}
                                <div class="chart-container">
                                    <canvas id="chart-${key}-pricing"></canvas>
                                </div>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-bold text-navy mb-4">Pricing Strategy Insight</h4>
                                <p class="text-gray-600 leading-relaxed mb-4">${d.pricing.insight}</p>
                                <table class="text-xs w-full">
                                    <thead><tr class="bg-gray-100"><th>Metric</th><th>Pressure?</th><th>Response</th><th>Decision</th></tr></thead>
                                    <tbody>
                                        ${d.pricing.strategy.map(s => `
                                            <tr>
                                                <td class="p-2 border-b font-semibold">${s.metric}</td>
                                                <td class="p-2 border-b ${s.pressure.includes('PRESSURE') || s.pressure.includes('compression') ? 'text-warning font-bold' : ''}">${s.pressure}</td>
                                                <td class="p-2 border-b">${s.response}</td>
                                                <td class="p-2 border-b italic">${s.decision}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="${key}-tab-6" class="tab-content hidden">
                        <h4 class="font-bold text-navy mb-6">Management Control Dashboard ‚Äî Top Management View</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${d.dashboard.map(k => `
                                <div class="card p-5 border-t-4" style="border-color: ${d.meta.color}">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-xs font-bold text-gray-400 uppercase">${k.name}</span>
                                        <span class="text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 border">${k.type}</span>
                                    </div>
                                    <div class="text-3xl font-bold text-navy mb-3">${k.act}</div>
                                    <div class="flex gap-2 mb-3">
                                        <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded">Target: ${k.target}</span>
                                        <span class="text-xs px-2 py-1 bg-red-100 text-red-800 rounded">Warn: ${k.warn}</span>
                                    </div>
                                    <div class="flex justify-between items-center border-t border-gray-100 pt-3">
                                        <span class="kpi-pill ${k.status === 'OK' ? 'kpi-ok' : 'kpi-warn'}">${k.status}</span>
                                        <span class="text-xs text-gray-500 italic text-right max-w-[60%]">${k.action}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                container.appendChild(section);
                
                // Initialize Charts for this company
                setTimeout(() => {
                    initCompanyCharts(key, d);
                }, 100);
            });
        }

        function switchTab(company, tabIndex) {
            const page = document.getElementById(`page-${company}`);
            // Update buttons
            page.querySelectorAll('.tab-btn').forEach((btn, idx) => {
                if (idx + 1 === tabIndex) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            // Update content
            page.querySelectorAll('.tab-content').forEach((content, idx) => {
                if (idx + 1 === tabIndex) content.classList.remove('hidden');
                else content.classList.add('hidden');
            });
        }

        // --- CHART INITIALIZATION HELPERS ---
        function initCompanyCharts(key, d) {
            // 1. Cost Structure (Stacked Bar)
            const ctxStructure = document.getElementById(`chart-${key}-structure`);
            if (ctxStructure) {
                const datasets = d.costStructure.years.map((yr, i) => {
                    const rev = d.costStructure.revenue[i];
                    const dataPoint = {
                        cogs: (d.costStructure.cogs[i] / rev * 100),
                        emp: (d.costStructure.emp[i] / rev * 100),
                        da: (d.costStructure.da[i] / rev * 100),
                        other: (d.costStructure.other[i] / rev * 100)
                    };
                    // Add extra fields for Nestle if they exist
                    if (d.costStructure.licence) dataPoint.licence = (d.costStructure.licence[i] / rev * 100);
                    if (d.costStructure.finance) dataPoint.finance = (d.costStructure.finance[i] / rev * 100);
                    return dataPoint;
                });
                
                const chartDatasets = [
                    { label: 'COGS %', data: datasets.map(x => x.cogs), backgroundColor: '#DC3545' },
                    { label: 'Employee %', data: datasets.map(x => x.emp), backgroundColor: '#FFC107' },
                    { label: 'D&A %', data: datasets.map(x => x.da), backgroundColor: '#0D6EFD' },
                    { label: 'Other %', data: datasets.map(x => x.other), backgroundColor: '#198754' }
                ];

                if (d.costStructure.licence) {
                    chartDatasets.push({ label: 'Licence %', data: datasets.map(x => x.licence), backgroundColor: '#6610f2' });
                }
                if (d.costStructure.finance) {
                    chartDatasets.push({ label: 'Finance %', data: datasets.map(x => x.finance), backgroundColor: '#6f42c1' });
                }

                const chart = new Chart(ctxStructure, {
                    type: 'bar',
                    data: {
                        labels: d.costStructure.years,
                        datasets: chartDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { x: { stacked: true }, y: { stacked: true, max: 100 } }
                    }
                });
                chart._originalData = JSON.parse(JSON.stringify(chart.data));
            }

            // 2. Cost Estimation (Line/Scatter)
            const ctxEst = document.getElementById(`chart-${key}-est`);
            if (ctxEst) {
                // Predicted Cost = FC + VC * Rev
                const predicted = d.costStructure.revenue.map(r => d.estimation.fc + (d.estimation.vcRate * r));
                // Actual Total Cost (Sum of components)
                const actual = d.costStructure.cogs.map((c, i) => c + d.costStructure.emp[i] + d.costStructure.da[i] + d.costStructure.other[i]);

                const chart = new Chart(ctxEst, {
                    type: 'line',
                    data: {
                        labels: d.costStructure.years,
                        datasets: [
                            { 
                                label: 'Actual Cost', 
                                data: actual, 
                                borderColor: '#DC3545', 
                                backgroundColor: '#DC3545', 
                                showLine: false, 
                                pointRadius: 6 
                            },
                            { 
                                label: 'Predicted (High-Low)', 
                                data: predicted, 
                                borderColor: d.meta.color, 
                                borderDash: [5, 5], 
                                tension: 0,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                chart._originalData = JSON.parse(JSON.stringify(chart.data));
            }

            // 3. Margin Analysis
            const ctxMargin = document.getElementById(`chart-${key}-margin`);
            if (ctxMargin) {
                // Use available years for margins (Nestle has gaps in source data array, but we mapped correctly in object)
                const labels = key === 'nestle' ? ['FY19', 'FY20', 'FY21', 'FY22', 'FY25'] : d.costStructure.years;
                
                const chart = new Chart(ctxMargin, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Gross Margin %', data: d.margins.gm, borderColor: '#198754', tension: 0.3 },
                            { label: 'EBITDA Margin %', data: d.margins.ebitda, borderColor: '#0D6EFD', tension: 0.3 },
                            { label: 'PAT Margin %', data: d.margins.pat, borderColor: '#FFC107', tension: 0.3 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                chart._originalData = JSON.parse(JSON.stringify(chart.data));
            }

            // 5. Pricing
            const ctxPricing = document.getElementById(`chart-${key}-pricing`);
            if (ctxPricing) {
                const bgColors = d.pricing.cogsG.map((c, i) => c > d.pricing.revG[i] ? '#DC3545' : '#198754');
                const chart = new Chart(ctxPricing, {
                    type: 'bar',
                    data: {
                        labels: d.pricing.years,
                        datasets: [
                            { label: 'Revenue Growth %', data: d.pricing.revG, backgroundColor: '#0D6EFD' },
                            { label: 'COGS Growth %', data: d.pricing.cogsG, backgroundColor: bgColors }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                chart._originalData = JSON.parse(JSON.stringify(chart.data));
            }
        }

        function renderIndustryCharts() {
            // Cipla vs Pharma
            const ctxCipla = document.getElementById('chart-ind-cipla');
            if (ctxCipla && !Chart.getChart(ctxCipla)) {
                new Chart(ctxCipla, {
                    type: 'bar',
                    data: {
                        labels: ['Gross Margin', 'EBITDA Margin', 'PAT Margin'],
                        datasets: [
                            { label: 'Cipla', data: [65.9, 25.7, 19.4], backgroundColor: '#00539C' },
                            { label: 'Pharma Avg', data: [62.0, 22.5, 17.0], backgroundColor: '#ADB5BD' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Nestle vs FMCG
            const ctxNestle = document.getElementById('chart-ind-nestle');
            if (ctxNestle && !Chart.getChart(ctxNestle)) {
                new Chart(ctxNestle, {
                    type: 'bar',
                    data: {
                        labels: ['Gross Margin', 'EBITDA Margin', 'PAT Margin'],
                        datasets: [
                            { label: 'Nestl√©', data: [56.4, 23.8, 16.0], backgroundColor: '#C8A84B' },
                            { label: 'FMCG Avg', data: [55.0, 22.0, 14.5], backgroundColor: '#ADB5BD' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Voltas vs Cap Goods
            const ctxVoltas = document.getElementById('chart-ind-voltas');
            if (ctxVoltas && !Chart.getChart(ctxVoltas)) {
                new Chart(ctxVoltas, {
                    type: 'bar',
                    data: {
                        labels: ['Gross Margin', 'EBITDA Margin', 'PAT Margin'],
                        datasets: [
                            { label: 'Voltas', data: [22.4, 8.9, 5.4], backgroundColor: '#C0392B' },
                            { label: 'Cap Goods Avg', data: [16.0, 8.5, 4.8], backgroundColor: '#ADB5BD' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Radar
            const ctxRadar = document.getElementById('chart-ind-radar');
            if (ctxRadar && !Chart.getChart(ctxRadar)) {
                new Chart(ctxRadar, {
                    type: 'radar',
                    data: {
                        labels: ['COGS %', 'Employee %', 'D&A %', 'Other %'],
                        datasets: [
                            { label: 'Cipla', data: [34.1, 17.8, 4.1, 24.5], borderColor: '#00539C', backgroundColor: 'rgba(0, 83, 156, 0.1)' },
                            { label: 'Nestl√©', data: [43.6, 10.1, 2.7, 22.8], borderColor: '#C8A84B', backgroundColor: 'rgba(200, 168, 75, 0.1)' },
                            { label: 'Voltas', data: [77.6, 5.8, 0.4, 9.4], borderColor: '#C0392B', backgroundColor: 'rgba(192, 57, 43, 0.1)' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Growth
            const ctxGrowth = document.getElementById('chart-ind-growth');
            if (ctxGrowth && !Chart.getChart(ctxGrowth)) {
                const chartGrowth = new Chart(ctxGrowth, {
                    type: 'line',
                    data: {
                        labels: ['FY22', 'FY23', 'FY24', 'FY25'],
                        datasets: [
                            { label: 'Cipla', data: [13.9, 3.9, 13.2, 6.7], borderColor: '#00539C', tension: 0.3 },
                            { label: 'Nestl√©', data: [14.5, 10.3, 14.5, 19.6], borderColor: '#C8A84B', tension: 0.3 }, // Adjusted for available data points logic
                            { label: 'Voltas', data: [5.0, 19.7, 31.4, 23.5], borderColor: '#C0392B', tension: 0.3 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                chartGrowth._originalData = JSON.parse(JSON.stringify(chartGrowth.data));
            }
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            buildCompanyPages();
        });

    </script>
</body>
</html>
